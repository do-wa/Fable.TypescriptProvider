// Learn more about F# at http://docs.microsoft.com/dotnet/fsharp

open System
open Transform

let leftPadSample = """{"Namespace":"index","Opens":["System","Fable.Core","Fable.Core.JS"],"Files":[{"Kind":"Index","FileName":"C:/Users/dominik/Projects/FSharp.Fable.TypescriptProvider/sample/Simple/node_modules/left-pad/index.d.ts","ModuleName":"left-pad","Modules":[{"HasDeclare":false,"IsNamespace":false,"Name":"","Types":[["Variable",{"Export":{"IsGlobal":false,"Selector":"*","Path":"left-pad"},"HasDeclare":true,"Name":"leftPad","Type":["Mapped",{"Name":"LeftPad.IExports","FullName":"LeftPad.IExports"}],"IsConst":true,"IsStatic":false,"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":false,"IsClass":false,"Name":"IExports","FullName":"IExports","TypeParameters":[],"Inherits":[],"Members":[["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"leftPad","TypeParameters":[],"Params":[{"Comment":null,"Name":"str","Optional":false,"ParamArray":false,"Type":["Union",{"Option":false,"Types":[["Mapped",{"Name":"string","FullName":"string"}],["Mapped",{"Name":"float","FullName":"float"}]]}]},{"Comment":null,"Name":"len","Optional":false,"ParamArray":false,"Type":["Mapped",{"Name":"float","FullName":"float"}]},{"Comment":null,"Name":"ch","Optional":true,"ParamArray":false,"Type":["Union",{"Option":false,"Types":[["Mapped",{"Name":"string","FullName":"string"}],["Mapped",{"Name":"float","FullName":"float"}]]}]}],"ReturnType":["Mapped",{"Name":"string","FullName":"string"}],"Accessibility":null}]],"Accessibility":null}],["Module",{"HasDeclare":true,"IsNamespace":true,"Name":"LeftPad","Types":[],"HelperLines":[],"Attributes":[]}],["ExportAssignment","leftPad"]],"HelperLines":[],"Attributes":[]}]}],"AbbrevTypes":[]}"""
let awesomebutton = """{"Namespace":"react-awesome-button.6.5.1","Opens":["System","Fable.Core","Fable.Core.JS"],"Files":[{"Kind":"Index","FileName":"C:/Users/dominik/Projects/FSharp.Fable.TypescriptProvider/sample/SimpleReact/node_modules/react-awesome-button/index.d.ts","ModuleName":"react-awesome-button","Modules":[{"HasDeclare":false,"IsNamespace":false,"Name":"","Types":[["Variable",{"Export":{"IsGlobal":false,"Selector":"*","Path":"react-awesome-button"},"HasDeclare":true,"Name":"``react-awesome-button``","Type":["Mapped",{"Name":"React_awesome_button.IExports","FullName":"React_awesome_button.IExports"}],"IsConst":true,"IsStatic":false,"Accessibility":null}],["Module",{"HasDeclare":true,"IsNamespace":false,"Name":"React_awesome_button","Types":[["Interface",{"Comments":[],"IsStatic":false,"IsClass":false,"Name":"IExports","FullName":"IExports","TypeParameters":[],"Inherits":[],"Members":[["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"AwesomeButton","Option":false,"Type":["Mapped",{"Name":"AwesomeButtonStatic","FullName":"AwesomeButtonStatic"}],"IsReadonly":true,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"AwesomeButtonProgress","Option":false,"Type":["Mapped",{"Name":"AwesomeButtonProgressStatic","FullName":"AwesomeButtonProgressStatic"}],"IsReadonly":true,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"AwesomeButtonSocial","Option":false,"Type":["Mapped",{"Name":"AwesomeButtonSocialStatic","FullName":"AwesomeButtonSocialStatic"}],"IsReadonly":true,"IsStatic":false,"Accessibility":null}]],"Accessibility":null}],["Import",["Type",{"ImportSpecifier":{"Name":"Component"},"SpecifiedModule":"React","ResolvedModule":null}]],["Interface",{"Comments":[],"IsStatic":false,"IsClass":false,"Name":"AwesomeButtonProps","FullName":"","TypeParameters":[],"Inherits":[],"Members":[["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"action","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"active","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"blocked","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"children","Option":false,"Type":["Mapped",{"Name":"React.ReactNode","FullName":""}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"className","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"cssModule","Option":false,"Type":["Mapped",{"Name":"obj","FullName":"obj"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"disabled","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"element","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"href","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"moveEvents","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"onPress","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"onReleased","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"placeholder","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"ripple","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"rootElement","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"size","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"style","Option":false,"Type":["Mapped",{"Name":"obj","FullName":"obj"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"target","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"title","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"``to``","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"``type``","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"visible","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}]],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":false,"IsClass":true,"Name":"AwesomeButton","FullName":"","TypeParameters":[],"Inherits":[["Generic",{"Type":["Mapped",{"Name":"Component","FullName":"error"}],"TypeParameters":[["Mapped",{"Name":"AwesomeButtonProps","FullName":""}],["Mapped",{"Name":"AwesomeButtonComponent","FullName":"AwesomeButtonComponent"}]]}]],"Members":[],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":true,"IsClass":true,"Name":"AwesomeButtonStatic","FullName":"","TypeParameters":[],"Inherits":[],"Members":[["Function",{"Comments":[],"Kind":"Constructor","IsStatic":true,"Name":"Create","TypeParameters":[],"Params":[],"ReturnType":["Generic",{"Type":["Mapped",{"Name":"AwesomeButton","FullName":"AwesomeButton"}],"TypeParameters":[]}],"Accessibility":null}]],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":false,"IsClass":false,"Name":"AwesomeButtonProgressProps","FullName":"","TypeParameters":[],"Inherits":[],"Members":[["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"action","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"children","Option":false,"Type":["Mapped",{"Name":"React.ReactNode","FullName":""}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"cssModule","Option":false,"Type":["Mapped",{"Name":"obj","FullName":"obj"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"disabled","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"fakePress","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"loadingLabel","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"onPress","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"releaseDelay","Option":false,"Type":["Mapped",{"Name":"float","FullName":"float"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"resultLabel","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"rootElement","Option":false,"Type":["Mapped",{"Name":"React.ReactNode","FullName":""}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"size","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"``type``","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}]],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":false,"IsClass":true,"Name":"AwesomeButtonProgress","FullName":"","TypeParameters":[],"Inherits":[["Generic",{"Type":["Mapped",{"Name":"Component","FullName":"error"}],"TypeParameters":[["Mapped",{"Name":"AwesomeButtonProgressProps","FullName":""}],["Mapped",{"Name":"AwesomeButtonComponent","FullName":"AwesomeButtonComponent"}]]}]],"Members":[],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":true,"IsClass":true,"Name":"AwesomeButtonProgressStatic","FullName":"","TypeParameters":[],"Inherits":[],"Members":[["Function",{"Comments":[],"Kind":"Constructor","IsStatic":true,"Name":"Create","TypeParameters":[],"Params":[],"ReturnType":["Generic",{"Type":["Mapped",{"Name":"AwesomeButtonProgress","FullName":"AwesomeButtonProgress"}],"TypeParameters":[]}],"Accessibility":null}]],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":false,"IsClass":false,"Name":"AwesomeButtonSocialProps","FullName":"","TypeParameters":[],"Inherits":[],"Members":[["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"action","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"children","Option":false,"Type":["Mapped",{"Name":"React.ReactNode","FullName":""}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"disabled","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"href","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"icon","Option":false,"Type":["Mapped",{"Name":"bool","FullName":"bool"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"iconHeight","Option":false,"Type":["Mapped",{"Name":"float","FullName":"float"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"iconWidth","Option":false,"Type":["Mapped",{"Name":"float","FullName":"float"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"image","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"message","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Function",{"Comments":[],"Kind":"Regular","IsStatic":false,"Name":"onPress","TypeParameters":[],"Params":[],"ReturnType":["Mapped",{"Name":"unit","FullName":"unit"}],"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"phone","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"``type``","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"url","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}],["Property",{"Comments":[],"Kind":"Regular","Index":null,"Name":"user","Option":false,"Type":["Mapped",{"Name":"string","FullName":"string"}],"IsReadonly":false,"IsStatic":false,"Accessibility":null}]],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":false,"IsClass":true,"Name":"AwesomeButtonSocial","FullName":"","TypeParameters":[],"Inherits":[["Generic",{"Type":["Mapped",{"Name":"Component","FullName":"error"}],"TypeParameters":[["Mapped",{"Name":"AwesomeButtonSocialProps","FullName":""}],["Mapped",{"Name":"AwesomeButtonComponent","FullName":"AwesomeButtonComponent"}]]}]],"Members":[],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":true,"IsClass":true,"Name":"AwesomeButtonSocialStatic","FullName":"","TypeParameters":[],"Inherits":[],"Members":[["Function",{"Comments":[],"Kind":"Constructor","IsStatic":true,"Name":"Create","TypeParameters":[],"Params":[],"ReturnType":["Generic",{"Type":["Mapped",{"Name":"AwesomeButtonSocial","FullName":"AwesomeButtonSocial"}],"TypeParameters":[]}],"Accessibility":null}]],"Accessibility":null}],["Interface",{"Comments":[],"IsStatic":false,"IsClass":false,"Name":"AwesomeButtonComponent","FullName":"AwesomeButtonComponent","TypeParameters":[],"Inherits":[],"Members":[],"Accessibility":null}]],"HelperLines":[],"Attributes":[]}]],"HelperLines":[],"Attributes":[]}]}],"AbbrevTypes":[]}"""

[<EntryPoint>]
let main argv =
    let fsFile = Thoth.Json.Net.Decode.Auto.fromString<ts2fable.Syntax.FsFileOut> leftPadSample
    let t = 
       match fsFile with 
        | Ok fsFile -> 
            let (allTypes, typeMap) = createSimplifiedTypeMap fsFile
            let (exVar, exIm, callableApi) = getTypeSignature typeMap
            let x = mapToErasableType callableApi
            callableApi
        | Error err -> failwith err
    //let test = Transform.toProvidedTypes (ProviderDsl.makeType("root", false)) t
    Microsoft.FSharpLu.Json.Compact.serializeToFile "./test.json" t

    0 // return an integer exit code